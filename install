#!/bin/bash

set -e

# The directory of the dotfiles repository.
dir="$( cd "$( dirname "${BASH_SOURCE:-$0}" )" && pwd )"

# Create a symlink from a file to a destination, moving any existing file to
# /tmp.
# Arguments:
#   - $1 file name
#   - $2 from path
#   - $3 destination path
symlink() {
  if [ -L $3 ]; then
    rm $3 # If its a link, remove it
  elif [ -f $3 ]; then
    tmp=$(mktemp "/tmp/${1}.XXX")
    echo "$3 exists already! moving to ${tmp}"
    mv $3 "${tmp}"
  fi

  mkdir -p $(dirname $3)
  ln -s $2 $3
}

# Install XDG configs.
symlink config.fish "${dir}/config.fish" "${HOME}/.config/fish/config.fish"
symlink gitconfig "${dir}/gitconfig" "${HOME}/.config/git/config"
symlink gitignore "${dir}/gitignore" "${HOME}/.config/git/ignore"
symlink lvim.lua "${dir}/lvim.lua" "${HOME}/.config/lvim/config.lua"
symlink starship.toml "${dir}/starship.toml" "${HOME}/.config/starship.toml"
symlink tmux.conf "${dir}/tmux.conf" "${HOME}/.config/tmux/tmux.conf"
symlink wezterm.lua "${dir}/wezterm.lua" "${HOME}/.config/wezterm/wezterm.lua"
