#!/bin/bash

# The directory of the dotfiles repository.
dir="$( cd "$( dirname "${BASH_SOURCE:-$0}" )" && pwd )"

# Create a symlink from a file to a destination, moving any existing file to
# /tmp.
# Arguments:
#   - $1 from path
#   - $2 destination path
symlink() {
  if [ -L $2 ]; then
    rm $2 # If its a link, remove it
  elif [ -f $2 ]; then
    tmp=$(mktemp -d)
    echo "$2 exists already! moving to ${tmp}"
    mv $2 "${tmp}/"
  fi

  ln -s $1 $2
}

for file in gitconfig gitignore hushlogin tmux.conf vimrc ideavimrc
do
  symlink "${dir}/${file}" "${HOME}/.${file}"
done

# Install ctags file from local rust repo.
if [ ! -e "${HOME}/stc/rust/rust/src/etc/ctags.rust" ]; then
  symlink "${HOME}/src/rust/rust/src/etc/ctags.rust" "${HOME}/.ctags"
fi

# Install vim plugins, if vim exists.
if [[ $(type -P vim) ]]; then

  if [ ! -e "${HOME}/.vim/autoload/plug.vim" ]; then
    curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
          https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  fi

  vim +PlugUpdate +qall
fi

# Install oh-my-fish and config, if fish exists.
if [[ $(type -P fish) ]]; then

  if [ ! -e "${HOME}/opt/oh-my-fish" ]; then
    mkdir -p $HOME/opt
    git clone git://github.com/oh-my-fish/oh-my-fish.git ${HOME}/opt/oh-my-fish
    cp ${HOME}/opt/oh-my-fish/templates/config.fish ~/.config/fish/config.fish
  fi

  symlink "${dir}/config.fish" "${HOME}/.config/fish/config.fish"
fi
